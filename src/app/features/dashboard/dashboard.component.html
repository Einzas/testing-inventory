<div class="dashboard">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 mb-1 text-dark fw-bold">Dashboard</h1>
      <p class="text-muted mb-0">Resumen general de tu negocio</p>
    </div>
    <div>
      <button class="btn btn-primary" routerLink="/invoicing/new">
        <i class="fas fa-plus me-2"></i>
        Nueva Factura
      </button>
    </div>
  </div>

  @if (isLoading()) {
    <!-- Loading State -->
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-3 text-muted">Cargando datos del dashboard...</p>
    </div>
  } @else {
    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="bg-primary bg-gradient rounded-3 p-3">
                  <i class="fas fa-boxes text-white fa-2x"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <div class="small text-muted">Total Productos</div>
                <div class="h4 mb-0 fw-bold">{{ stats().totalProducts }}</div>
              </div>
            </div>
            <div class="mt-3">
              <a routerLink="/products" class="btn btn-outline-primary btn-sm">
                <i class="fas fa-eye me-1"></i>
                Ver productos
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="bg-warning bg-gradient rounded-3 p-3">
                  <i class="fas fa-exclamation-triangle text-white fa-2x"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <div class="small text-muted">Stock Bajo</div>
                <div class="h4 mb-0 fw-bold text-warning">{{ stats().lowStockProducts }}</div>
              </div>
            </div>
            <div class="mt-3">
              <a routerLink="/products/low-stock" class="btn btn-outline-warning btn-sm">
                <i class="fas fa-eye me-1"></i>
                Ver alertas
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="bg-info bg-gradient rounded-3 p-3">
                  <i class="fas fa-users text-white fa-2x"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <div class="small text-muted">Total Clientes</div>
                <div class="h4 mb-0 fw-bold">{{ stats().totalCustomers }}</div>
              </div>
            </div>
            <div class="mt-3">
              <a routerLink="/customers" class="btn btn-outline-info btn-sm">
                <i class="fas fa-eye me-1"></i>
                Ver clientes
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="bg-success bg-gradient rounded-3 p-3">
                  <i class="fas fa-file-invoice-dollar text-white fa-2x"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <div class="small text-muted">Total Ventas</div>
                <div class="h5 mb-0 fw-bold text-success">{{ formatCurrency(stats().totalAmount) }}</div>
              </div>
            </div>
            <div class="mt-3">
              <a routerLink="/invoicing" class="btn btn-outline-success btn-sm">
                <i class="fas fa-eye me-1"></i>
                Ver facturas
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Row -->
    <div class="row">
      <!-- Low Stock Products -->
      <div class="col-lg-6 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-white border-bottom">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0 fw-bold">
                <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                Productos con Stock Bajo
              </h5>
              <a routerLink="/products/low-stock" class="btn btn-outline-warning btn-sm">
                Ver todos
              </a>
            </div>
          </div>
          <div class="card-body">
            @if (lowStockProducts().length === 0) {
              <div class="text-center py-4">
                <i class="fas fa-check-circle text-success fa-3x mb-3"></i>
                <p class="text-muted">¡Excelente! No hay productos con stock bajo</p>
              </div>
            } @else {
              <div class="list-group list-group-flush">
                @for (product of lowStockProducts(); track product.id) {
                  <div class="list-group-item border-0 px-0">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <h6 class="mb-1 fw-semibold">{{ product.name }}</h6>
                        <p class="mb-0 small text-muted">Código: {{ product.code }}</p>
                      </div>
                      <div class="text-end">
                        <span class="badge bg-warning">{{ product.stock }} und.</span>
                        <div class="small text-muted">Mín: {{ product.minStock }}</div>
                      </div>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Recent Invoices -->
      <div class="col-lg-6 mb-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-white border-bottom">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0 fw-bold">
                <i class="fas fa-file-invoice text-primary me-2"></i>
                Facturas Recientes
              </h5>
              <a routerLink="/invoicing" class="btn btn-outline-primary btn-sm">
                Ver todas
              </a>
            </div>
          </div>
          <div class="card-body">
            @if (recentInvoices().length === 0) {
              <div class="text-center py-4">
                <i class="fas fa-file-invoice text-muted fa-3x mb-3"></i>
                <p class="text-muted">No hay facturas registradas</p>
                <a routerLink="/invoicing/new" class="btn btn-primary btn-sm">
                  <i class="fas fa-plus me-1"></i>
                  Crear primera factura
                </a>
              </div>
            } @else {
              <div class="list-group list-group-flush">
                @for (invoice of recentInvoices(); track invoice.id) {
                  <div class="list-group-item border-0 px-0">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <h6 class="mb-1 fw-semibold">{{ invoice.series }}-{{ invoice.number }}</h6>
                        <p class="mb-0 small text-muted">
                          <i class="fas fa-calendar me-1"></i>
                          {{ invoice.issueDate | date:'dd/MM/yyyy' }}
                        </p>
                      </div>
                      <div class="text-end">
                        <div class="fw-bold">{{ formatCurrency(invoice.totalAmount) }}</div>
                        <span [class]="getStatusClass(invoice.status)">
                          {{ getStatusText(invoice.status) }}
                        </span>
                      </div>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h5 class="mb-0 fw-bold">
              <i class="fas fa-bolt text-warning me-2"></i>
              Acciones Rápidas
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-3 col-md-6 mb-3">
                <a routerLink="/invoicing/new" class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center py-3">
                  <i class="fas fa-plus fa-2x mb-2"></i>
                  <span class="fw-semibold">Nueva Factura</span>
                </a>
              </div>
              <div class="col-lg-3 col-md-6 mb-3">
                <a routerLink="/customers/new" class="btn btn-outline-info w-100 h-100 d-flex flex-column align-items-center py-3">
                  <i class="fas fa-user-plus fa-2x mb-2"></i>
                  <span class="fw-semibold">Nuevo Cliente</span>
                </a>
              </div>
              <div class="col-lg-3 col-md-6 mb-3">
                <a routerLink="/products/new" class="btn btn-outline-success w-100 h-100 d-flex flex-column align-items-center py-3">
                  <i class="fas fa-box fa-2x mb-2"></i>
                  <span class="fw-semibold">Nuevo Producto</span>
                </a>
              </div>
              <div class="col-lg-3 col-md-6 mb-3">
                <a routerLink="/reports" class="btn btn-outline-warning w-100 h-100 d-flex flex-column align-items-center py-3">
                  <i class="fas fa-chart-bar fa-2x mb-2"></i>
                  <span class="fw-semibold">Ver Reportes</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>
